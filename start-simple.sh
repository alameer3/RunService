#!/bin/bash

echo "==== ุจุฏุก ุชุดุบูู ุนุฑุถ Ubuntu Desktop ุงูุชูุถูุญู $(date) ===="

# ๐ ุฅูุดุงุก ูุฌูุฏ ุงูุณุฌูุงุช
echo "๐ [1/4] ุฅูุดุงุก ูุฌูุฏ ุงูุณุฌูุงุช..."
mkdir -p logs

# ๐ ุฅูุดุงุก ุตูุญุฉ ุชุฑุญูุจ ุชูุงุนููุฉ
echo "๐ [2/4] ุฅูุดุงุก ุงูุตูุญุฉ ุงูุชูุงุนููุฉ..."
if [ ! -f "simple-vnc-demo.html" ]; then
    echo "โ ููู ุงูุนุฑุถ ุงูุชูุถูุญู ุบูุฑ ููุฌูุฏ!"
    exit 1
fi

# ๐ ุชุดุบูู ุฎุงุฏู HTTP ููุนุฑุถ ุงูุชูุถูุญู ุนูู ุงููููุฐ 5000
echo "๐ [3/4] ุชุดุบูู ุฎุงุฏู HTTP ููุนุฑุถ ุงูุชูุถูุญู ุนูู ุงููููุฐ 5000..."
python3 -m http.server 5000 --bind 0.0.0.0 > ./logs/http-demo.log 2>&1 &
HTTP_PID=$!
sleep 2

# โ ุงูุชุญูู ูู ุชุดุบูู ุฎุงุฏู HTTP
echo "โ [4/4] ุงูุชุญูู ูู ุชุดุบูู ุงูุฎุงุฏู..."
if ps -p $HTTP_PID > /dev/null; then
    echo "โ ุฎุงุฏู ุงูุนุฑุถ ุงูุชูุถูุญู ูุนูู ุนูู ุงููููุฐ 5000"
else
    echo "โ ูุดู ูู ุชุดุบูู ุฎุงุฏู HTTP"
    cat ./logs/http-demo.log
    exit 1
fi

# ๐ ุนุฑุถ ูุนูููุงุช ุงูุงุชุตุงู
echo ""
echo "๐ ูุนูููุงุช ุงูุงุชุตุงู:"
echo "================================="
echo "๐ฏ ุฑุงุจุท ุงูุนุฑุถ ุงูุชูุถูุญู: http://localhost:5000/simple-vnc-demo.html"
echo "๐ ุตูุญุฉ ุงููุดุฑูุน: http://localhost:5000"
echo ""
echo "๐ ููุงุญุธุงุช ูุงูุฉ:"
echo "โข ูุฐุง ุนุฑุถ ุชูุถูุญู ุชูุงุนูู ููุดุฑูุน Ubuntu Desktop"
echo "โข ููุญุตูู ุนูู ุณุทุญ ููุชุจ ุญููููุ ุชุญุชุงุฌ ูุชุดุบูู Docker"
echo "โข ุชุญุชูู ุงูุตูุญุฉ ุนูู ุชุนูููุงุช ุงูุชุดุบูู ุงููุงููุฉ"
echo ""
echo "๐ ููุชุดุบูู ุงููุนูู:"
echo "  docker build -t ubuntu-desktop ."
echo "  docker run -p 5000:5000 -p 6080:6080 ubuntu-desktop"

# ๐ ุฅุจูุงุก ุงูุชุทุจูู ูุนูู
echo ""
echo "๐ ุงูุฎุงุฏู ูุนูู... ููุฅููุงู ุงุถุบุท Ctrl+C"

# ุฅูุดุงุก ูุธููุฉ ูุชูุธูู ุงูุนูููุงุช ุนูุฏ ุงูุฎุฑูุฌ
cleanup() {
    echo ""
    echo "๐ ุฅููุงู ุฎุงุฏู HTTP..."
    kill $HTTP_PID 2>/dev/null
    echo "โ ุชู ุฅููุงู ุฌููุน ุงูุนูููุงุช"
    exit 0
}

trap cleanup SIGINT SIGTERM

# ุฅุจูุงุก ุงูุณูุฑูุจุช ูุนูู
tail -f /dev/null